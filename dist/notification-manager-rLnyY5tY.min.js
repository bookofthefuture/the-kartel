var e,t,i=Object.getOwnPropertyNames,s=(e={"notification-manager-rLnyY5tY.min.js"(e,t){class i{constructor(){this.currentUser=null,this.isLoggedIn=!1,this.isAdmin=!1,this.token=localStorage.getItem("kartel_auth_token")||localStorage.getItem("kartel_member_token")||localStorage.getItem("kartel_admin_token"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.init()}):setTimeout(()=>this.init(),50)}async init(){const e=new URLSearchParams(window.location.search),t=e.get("token"),i=e.has("register")&&e.has("email");if(!t||i)if(this.token){const e=localStorage.getItem("kartel_user_data"),t="true"===localStorage.getItem("kartel_is_admin"),i="true"===localStorage.getItem("kartel_is_super_admin");if(e)try{this.currentUser=JSON.parse(e),this.isLoggedIn=!0,this.isAdmin=t,this.isSuperAdmin=i,this.onAuthSuccess()}catch(s){this.clearAuth(),this.showLogin()}else this.clearAuth(),this.showLogin()}else this.showLogin();else await this.verifyMagicToken(t)}async verifyToken(){try{if(!this.token)return void this.showLogin();const e=await fetch("/.netlify/functions/verify-login-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:this.token})});if(e.ok){const t=await e.json();this.setUserData(t),this.onAuthSuccess()}else this.clearAuth(),this.showLogin()}catch(e){this.clearAuth(),this.showLogin()}}async verifyMagicToken(e){try{const t=await fetch("/.netlify/functions/verify-login-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(t.ok){const e=await t.json();if(e.success)return this.token=e.token,this.setUserData(e),window.history.replaceState({},document.title,window.location.pathname),void this.onAuthSuccess()}this.showMessage("Invalid or expired login link","error"),this.showLogin()}catch(t){this.showMessage("Login verification failed","error"),this.showLogin()}}setUserData(e){var t,i,s,n,o,r,a;this.currentUser={id:e.memberId,email:e.memberEmail,firstName:(null==(t=e.memberProfile)?void 0:t.firstName)||"",lastName:(null==(i=e.memberProfile)?void 0:i.lastName)||"",fullName:e.memberFullName,company:(null==(s=e.memberProfile)?void 0:s.company)||"",position:(null==(n=e.memberProfile)?void 0:n.position)||"",phone:(null==(o=e.memberProfile)?void 0:o.phone)||"",linkedin:(null==(r=e.memberProfile)?void 0:r.linkedin)||"",hasPassword:(null==(a=e.memberProfile)?void 0:a.hasPassword)||!1},this.isLoggedIn=!0,this.isAdmin=e.isAdmin||!1,this.isSuperAdmin=e.isSuperAdmin||!1,localStorage.setItem("kartel_auth_token",this.token),localStorage.setItem("kartel_user_data",JSON.stringify(this.currentUser)),localStorage.setItem("kartel_is_admin",this.isAdmin.toString()),localStorage.setItem("kartel_is_super_admin",this.isSuperAdmin.toString()),localStorage.setItem("kartel_member_token",this.token),localStorage.setItem("kartel_member_email",this.currentUser.email),localStorage.setItem("kartel_member_id",this.currentUser.id),localStorage.setItem("kartel_member_firstName",this.currentUser.firstName||""),localStorage.setItem("kartel_member_lastName",this.currentUser.lastName||""),localStorage.setItem("kartel_member_isAdmin",this.isAdmin.toString()),this.isAdmin&&(localStorage.setItem("kartel_admin_token",this.token),localStorage.setItem("kartel_admin_user",JSON.stringify(this.currentUser)))}async login(e,t=null){try{const i=await fetch("/.netlify/functions/member-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),s=await i.json();return i.ok&&s.success?(this.token=s.token,this.setUserData(s),t?(this.onAuthSuccess(),{success:!0,message:"Login successful!"}):(this.showCheckEmail(e),{success:!0,checkEmail:!0,message:"Check your email for the login link!"})):{success:!1,error:s.error||"Login failed"}}catch(i){return{success:!1,error:"Network error. Please try again."}}}logout(){this.clearAuth(),this.showLogin(),window.location.pathname.includes("admin")?window.location.href="/admin.html":window.location.href="/members.html"}clearAuth(){this.currentUser=null,this.isLoggedIn=!1,this.isAdmin=!1,this.isSuperAdmin=!1,this.token=null,localStorage.removeItem("kartel_auth_token"),localStorage.removeItem("kartel_user_data"),localStorage.removeItem("kartel_is_admin"),localStorage.removeItem("kartel_is_super_admin"),localStorage.removeItem("kartel_admin_token"),localStorage.removeItem("kartel_admin_user"),localStorage.removeItem("kartel_member_token"),localStorage.removeItem("kartel_member_email"),localStorage.removeItem("kartel_member_id"),localStorage.removeItem("kartel_member_firstName"),localStorage.removeItem("kartel_member_lastName"),localStorage.removeItem("kartel_member_company"),localStorage.removeItem("kartel_member_position"),localStorage.removeItem("kartel_member_phone"),localStorage.removeItem("kartel_member_linkedin"),localStorage.removeItem("kartel_member_hasPassword")}showLogin(){const e=document.getElementById("loginSection"),t=document.getElementById("dashboardSection"),i=document.getElementById("loadingSection");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),i&&i.classList.add("hidden"),this.renderLoginForm()}showCheckEmail(e){const t=document.getElementById("checkEmailMessage");t&&(t.innerHTML="\n                <h3>Check Your Email!</h3>\n                <p>We've sent a secure login link to <strong>".concat(e,'</strong></p>\n                <p>Click the link in your email to access your account.</p>\n                <div class="sub-text">Didn\'t receive it? Check your spam folder or try again.</div>\n            '),t.classList.remove("hidden"));const i=document.getElementById("magicLinkForm"),s=document.getElementById("passwordForm");i&&i.classList.add("hidden"),s&&s.classList.add("hidden")}onAuthSuccess(){const e=document.getElementById("loginSection"),t=document.getElementById("loginContainer"),i=document.getElementById("dashboardSection"),s=document.getElementById("loadingSection");e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),s&&s.classList.add("hidden"),i&&i.classList.remove("hidden"),window.kartelTopBar&&setTimeout(()=>{window.kartelTopBar.render(),window.kartelTopBar.updateUser(this.currentUser,this.isAdmin)},100),"function"==typeof window.onAuthSuccess&&window.onAuthSuccess(this.currentUser,this.isAdmin)}renderLoginForm(){const e=document.getElementById("loginContainer");e&&(e.innerHTML='\n            <div class="login-card">\n                <h1 class="login-title">The Kartel</h1>\n                <p style="margin-bottom: 30px; color: #7f8c8d;">Access your account</p>\n                \n                \x3c!-- Login Method Tabs --\x3e\n                <div class="login-tabs">\n                    <button type="button" class="login-tab active" onclick="kartelAuth.showMagicLinkTab()">Magic Link</button>\n                    <button type="button" class="login-tab" onclick="kartelAuth.showPasswordTab()">Password</button>\n                </div>\n                \n                \x3c!-- Magic Link Form --\x3e\n                <form id="magicLinkForm" class="login-form">\n                    <div class="form-group">\n                        <label for="magicLinkEmail">Email Address</label>\n                        <input type="email" id="magicLinkEmail" name="email" required placeholder="your@email.com">\n                    </div>\n                    <button type="submit" class="login-btn">Send Magic Link</button>\n                </form>\n                \n                \x3c!-- Password Form --\x3e\n                <form id="passwordForm" class="login-form hidden">\n                    <div class="form-group">\n                        <label for="passwordEmail">Email Address</label>\n                        <input type="email" id="passwordEmail" name="email" required placeholder="your@email.com">\n                    </div>\n                    <div class="form-group">\n                        <label for="password">Password</label>\n                        <input type="password" id="password" name="password" required placeholder="Your password">\n                    </div>\n                    <button type="submit" class="login-btn">Sign In</button>\n                    <button type="button" class="forgot-password-btn" onclick="kartelAuth.showForgotPassword()">Forgot Password?</button>\n                </form>\n                \n                \x3c!-- Check Email Message --\x3e\n                <div id="checkEmailMessage" class="check-email-message hidden"></div>\n                \n                \x3c!-- Messages --\x3e\n                <div id="loginMessage" class="hidden"></div>\n            </div>\n        ',this.attachLoginEventListeners())}showMagicLinkTab(){document.querySelectorAll(".login-tab").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".login-form").forEach(e=>e.classList.add("hidden")),document.querySelector(".login-tab:first-child").classList.add("active"),document.getElementById("magicLinkForm").classList.remove("hidden"),document.getElementById("checkEmailMessage").classList.add("hidden")}showPasswordTab(){document.querySelectorAll(".login-tab").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".login-form").forEach(e=>e.classList.add("hidden")),document.querySelector(".login-tab:last-child").classList.add("active"),document.getElementById("passwordForm").classList.remove("hidden"),document.getElementById("checkEmailMessage").classList.add("hidden")}showForgotPassword(){this.showMagicLinkTab();const e=document.getElementById("magicLinkEmail"),t=document.getElementById("passwordEmail");t.value&&(e.value=t.value),document.querySelector('#magicLinkForm button[type="submit"]').textContent="Send Reset Link",document.getElementById("magicLinkForm").setAttribute("data-reset-mode","true")}attachLoginEventListeners(){const e=document.getElementById("magicLinkForm");e&&e.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("magicLinkEmail").value,i=await this.login(t);this.showMessage(i.message,i.success?"success":"error")});const t=document.getElementById("passwordForm");t&&t.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("passwordEmail").value,i=document.getElementById("password").value,s=await this.login(t,i);s.success&&!s.checkEmail||this.showMessage(s.message,s.success?"success":"error")})}showMessage(e,t="info"){const i=document.getElementById("loginMessage");i&&(i.className=t,i.textContent=e,i.classList.remove("hidden"),setTimeout(()=>{i.classList.add("hidden")},5e3))}requireAuth(e="/members.html"){return!!this.isLoggedIn||(window.location.href=e,!1)}requireAdmin(e="/members.html"){return!(!this.isLoggedIn||!this.isAdmin)||(window.location.href=e,!1)}getUser(){return this.currentUser}getToken(){return this.token}getUserFullName(){var e,t;return(null==(e=this.currentUser)?void 0:e.fullName)||(null==(t=this.currentUser)?void 0:t.email)||"User"}isUserAdmin(){return this.isAdmin}isUserSuperAdmin(){return this.isSuperAdmin}isUserLoggedIn(){return this.isLoggedIn}}window.kartelAuth=new i,void 0!==t&&t.exports&&(t.exports=i);class s{constructor(){this.currentUser=null,this.isAdmin=!1,this.currentPage=this.detectCurrentPage(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.render()):this.render()}detectCurrentPage(){const e=window.location.pathname;return e.includes("super-admin")?"super-admin":e.includes("admin")?"admin":e.includes("members")?"members":"public"}updateUser(e,t){this.currentUser=e,this.isAdmin=t,this.isSuperAdmin=e&&e.isSuperAdmin||window.kartelAuth&&window.kartelAuth.isSuperAdmin,this.updateUserDisplay(),this.updateNavigation()}render(){const e=document.querySelector(".header");e&&(e.innerHTML='\n            <div class="header-content">\n                <div class="header-logo">\n                    <img src="/assets/the-kartel-logo-crop.png" alt="The Kartel Logo">\n                    <h1 class="header-title">The Kartel'.concat(this.isSuperAdmin?' <span class="super-admin-badge">Super Admin</span>':"",'</h1>\n                </div>\n                <div class="header-navigation">\n                    ').concat(this.renderNavigation(),"\n                    ").concat(this.renderUserSection(),"\n                </div>\n            </div>\n        "),this.attachEventListeners(),this.updateSliderPosition())}renderNavigation(){if(!this.currentUser)return"";const e=[];if(e.push({key:"members",name:"Member",url:"/members.html"}),(this.isAdmin||this.isSuperAdmin)&&e.push({key:"admin",name:"Admin",url:"/admin.html"}),this.isSuperAdmin&&e.push({key:"super-admin",name:"Super",url:"/super-admin.html"}),e.length<=1)return'<span class="page-indicator">'.concat({"super-admin":"Super Admin",admin:"Admin",members:"Member"}[this.currentPage]||"Dashboard","</span>");const t=e.map(e=>'\n            <div class="slider-option '.concat(e.key===this.currentPage?"active":"",'" \n                 data-view="').concat(e.key,'" \n                 onclick="kartelTopBar.switchToView(\'').concat(e.url,"')\">\n                ").concat(e.name,"\n            </div>\n        ")).join("");return'\n            <div class="view-slider">\n                <div class="slider-track">\n                    '.concat(t,'\n                    <div class="slider-indicator"></div>\n                </div>\n            </div>\n        ')}renderUserSection(){if(!this.currentUser)return"";this.currentUser.fullName||this.currentUser.firstName||this.currentUser.email;const e=this.currentUser.firstName||this.currentUser.email,t="members"===this.currentPage,i='<span class="member-name-clickable" onclick="'.concat(t?"openProfileModal()":"kartelTopBar.switchToMembers()",'">').concat(e,"</span>");return'\n            <div class="user-info">\n                '.concat(i,'\n                <button class="logout-btn" onclick="kartelTopBar.logout()">Logout</button>\n            </div>\n        ')}updateUserDisplay(){const e=document.querySelector(".user-name");if(e&&this.currentUser){const t=this.currentUser.fullName||this.currentUser.firstName||this.currentUser.email;e.textContent="Welcome, ".concat(t)}}updateNavigation(){const e=document.querySelector(".header-navigation");if(e){const t=e.querySelector(".user-info"),i=this.renderNavigation();e.querySelectorAll(".page-indicator, .switch-btn, .view-slider").forEach(e=>e.remove()),t?t.insertAdjacentHTML("beforebegin",i):e.insertAdjacentHTML("beforeend",i),this.updateSliderPosition()}}switchToMembers(){window.location.href="/members.html"}switchToAdmin(){this.isAdmin&&(window.location.href="/admin.html")}switchToSuperAdmin(){this.isSuperAdmin&&(window.location.href="/super-admin.html")}switchToView(e){window.location.href=e}updateSliderPosition(){setTimeout(()=>{const e=document.querySelector(".slider-option.active"),t=document.querySelector(".slider-indicator");if(e&&t){const i=e.parentElement.getBoundingClientRect(),s=e.getBoundingClientRect(),n=s.left-i.left,o=s.width;t.style.transform="translateX(".concat(n,"px)"),t.style.width="".concat(o,"px")}},50)}logout(){window.kartelAuth?window.kartelAuth.logout():(localStorage.clear(),window.location.href="/members.html")}attachEventListeners(){}show(){const e=document.querySelector(".header");e&&(e.style.display="block")}hide(){const e=document.querySelector(".header");e&&(e.style.display="none")}updateLogo(e,t="The Kartel Logo"){const i=document.querySelector(".header-logo img");i&&(i.src=e,i.alt=t)}updateTitle(e){const t=document.querySelector(".header-title");t&&(t.textContent=e)}}window.kartelTopBar=new s,void 0!==t&&t.exports&&(t.exports=s);class n{constructor(e="member"){this.userType=e,this.vapidPublicKey=null,this.subscription=null,this.isSupported="serviceWorker"in navigator&&"PushManager"in window,this.isSupported&&this.init()}async init(){try{await this.getVapidKey(),await this.checkExistingSubscription(),this.checkPermissionStatus()}catch(e){}}async getVapidKey(){try{const e=await fetch("/.netlify/functions/get-vapid-key");if(!e.ok)throw new Error("Failed to get VAPID key");{const t=await e.json();this.vapidPublicKey=t.publicKey}}catch(e){}}async checkExistingSubscription(){if(this.isSupported)try{const e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();t&&(this.subscription=t,await this.updateSubscriptionOnServer(t))}catch(e){}}checkPermissionStatus(){if(!this.isSupported)return;const e=Notification.permission;"default"!==e||localStorage.getItem("kartel_".concat(this.userType,"_notifications_dismissed"))?"granted"!==e||this.subscription||this.subscribe():setTimeout(()=>{this.showPermissionPrompt()},"admin"===this.userType?15e3:1e4)}showPermissionPrompt(){const e="notificationPrompt_".concat(this.userType);if(document.getElementById(e))return;const t="admin"===this.userType,i=t?"#e74c3c":"#2c3e50",s=t?"#c0392b":"#3498db",n=document.createElement("div");if(n.id=e,n.style.cssText="\n            position: fixed; bottom: 20px; right: 20px; background: ".concat(i,"; color: white;\n            padding: 20px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n            z-index: 10000; max-width: 350px; font-family: 'League Spartan', sans-serif;\n            animation: slideInUp 0.3s ease-out;\n        "),!document.getElementById("notificationPromptStyles")){const e=document.createElement("style");e.id="notificationPromptStyles",e.textContent="\n                @keyframes slideInUp {\n                    from { transform: translateY(100%); opacity: 0; }\n                    to { transform: translateY(0); opacity: 1; }\n                }\n                @keyframes slideOutDown {\n                    from { transform: translateY(0); opacity: 1; }\n                    to { transform: translateY(100%); opacity: 0; }\n                }\n            ",document.head.appendChild(e)}n.innerHTML='\n            <div style="margin-bottom: 15px;">\n                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 5px;">\n                    🔔 Stay Updated\n                </div>\n                <div style="font-size: 0.9rem; line-height: 1.4; opacity: 0.9;">\n                    '.concat(t?"Get instant notifications for new applications, events, and system alerts.":"Get notified about new events, updates, and important announcements.",'\n                </div>\n            </div>\n            <div style="display: flex; gap: 10px; flex-wrap: wrap;">\n                <button id="enableNotifications_').concat(this.userType,'" style="\n                    background: ').concat(s,'; color: white; border: none; \n                    padding: 10px 16px; border-radius: 5px; cursor: pointer; \n                    font-family: inherit; font-weight: 600; flex: 1;\n                ">Enable Notifications</button>\n                <button id="dismissNotifications_').concat(this.userType,'" style="\n                    background: transparent; color: #ecf0f1; border: 1px solid #bdc3c7; \n                    padding: 10px 16px; border-radius: 5px; cursor: pointer; \n                    font-family: inherit; flex: 1;\n                ">Maybe Later</button>\n            </div>\n        '),document.body.appendChild(n),document.getElementById("enableNotifications_".concat(this.userType)).addEventListener("click",()=>{this.requestPermission(),this.dismissPrompt(e)}),document.getElementById("dismissNotifications_".concat(this.userType)).addEventListener("click",()=>{localStorage.setItem("kartel_".concat(this.userType,"_notifications_dismissed"),"true"),this.dismissPrompt(e)})}dismissPrompt(e){const t=document.getElementById(e);t&&(t.style.animation="slideOutDown 0.3s ease-in",setTimeout(()=>t.remove(),300))}async requestPermission(){if(!this.isSupported)return!1;try{return"granted"===await Notification.requestPermission()?(await this.subscribe(),this.showSuccessMessage(),!0):(this.showErrorMessage("Notifications were not enabled. You can enable them later in your browser settings."),!1)}catch(e){return this.showErrorMessage("Failed to enable notifications. Please try again."),!1}}async subscribe(){if(this.isSupported&&this.vapidPublicKey)try{const e=await navigator.serviceWorker.ready,t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)});this.subscription=t,await this.updateSubscriptionOnServer(t)}catch(e){this.showErrorMessage("Failed to set up notifications. Please try again.")}}async updateSubscriptionOnServer(e){try{const t="admin"===this.userType?"admin":window.currentMember?window.currentMember.id:null,i=await fetch("/.netlify/functions/subscribe-notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e,userType:this.userType,userId:t})});if(!i.ok)throw new Error("Failed to store subscription on server");{const e=await i.json();localStorage.setItem("kartel_".concat(this.userType,"_subscription_id"),e.subscriptionId)}}catch(t){}}async unsubscribe(){if(this.subscription)try{await this.subscription.unsubscribe(),this.subscription=null,localStorage.removeItem("kartel_".concat(this.userType,"_subscription_id")),this.showSuccessMessage("Notifications have been disabled.")}catch(e){this.showErrorMessage("Failed to disable notifications.")}}urlBase64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),s=new Uint8Array(i.length);for(let n=0;n<i.length;++n)s[n]=i.charCodeAt(n);return s}showSuccessMessage(e){this.showMessage(e,"success")}showErrorMessage(e){this.showMessage(e,"error")}showMessage(e,t="info"){const i="notificationMessage_".concat(Date.now()),s="success"===t?"#27ae60":"#e74c3c",n=document.createElement("div");n.id=i,n.style.cssText="\n            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);\n            background: ".concat(s,"; color: white; padding: 15px 25px;\n            border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n            z-index: 10001; font-family: 'League Spartan', sans-serif;\n            font-weight: 600; animation: slideInDown 0.3s ease-out;\n        "),n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOutUp 0.3s ease-in",setTimeout(()=>n.remove(),300)},4e3)}isEnabled(){return"granted"===Notification.permission&&null!==this.subscription}getStatus(){return{supported:this.isSupported,permission:Notification.permission,subscribed:!!this.subscription,userType:this.userType}}}window.NotificationManager=n,void 0!==t&&t.exports&&(t.exports=n)}},function(){return t||(0,e[i(e)[0]])((t={exports:{}}).exports,t),t.exports});export default s();
