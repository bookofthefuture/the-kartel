function e(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}import"../notification-manager-D8Eu9tJl.min.js";let t=localStorage.getItem("kartel_admin_token"),n=[],o=[],a=[],i=null;function s(e){if(!e)return"";const t=e.trim();if(!t)return"";const n=[/^https?:\/\/(www\.)?linkedin\.com\/in\/([a-zA-Z0-9\-]+)\/?.*$/,/^https?:\/\/(www\.)?uk\.linkedin\.com\/in\/([a-zA-Z0-9\-]+)\/?.*$/,/^https?:\/\/(www\.)?linkedin\.com\/pub\/([a-zA-Z0-9\-]+)\/?.*$/,/^https?:\/\/(www\.)?uk\.linkedin\.com\/pub\/([a-zA-Z0-9\-]+)\/?.*$/,/^linkedin\.com\/in\/([a-zA-Z0-9\-]+)\/?.*$/,/^uk\.linkedin\.com\/in\/([a-zA-Z0-9\-]+)\/?.*$/,/^www\.linkedin\.com\/in\/([a-zA-Z0-9\-]+)\/?.*$/,/^www\.uk\.linkedin\.com\/in\/([a-zA-Z0-9\-]+)\/?.*$/,/^([a-zA-Z0-9\-]+)$/];for(const a of n){const e=t.match(a);if(e)return e[2]||e[1]}const o=t.match(/(uk\.)?linkedin\.com\/in\/([a-zA-Z0-9\-]+)/);return o?o[2]:(/^[a-zA-Z0-9\-]+$/.test(t),t)}function d(e,t="success",n="messageContainer"){const o=document.getElementById(n);o.innerHTML='<div class="'.concat(t,'">').concat(e,"</div>"),setTimeout(()=>o.innerHTML="",5e3)}function c(e,t="messageContainer"){d(e,"error",t)}async function r(){try{const e=await fetch("/.netlify/functions/get-venues",{headers:{Authorization:"Bearer ".concat(t)}});if(401===e.status)return t=null,localStorage.removeItem("kartel_admin_token"),void b();if(!e.ok)throw new Error("Failed to load venues");const n=await e.json();a=n.venues||[],function(){const e=a.length,t=a.filter(e=>{const t=new Date(e.createdAt),n=new Date;return t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()}).length;document.getElementById("totalVenues").textContent=e,document.getElementById("activeVenues").textContent=e,document.getElementById("venuesWithEvents").textContent=0,document.getElementById("recentVenues").textContent=t}(),u()}catch(e){console.error("Error loading venues:",e),c("Failed to load venues. Please try again.","venuesMessageContainer")}}async function l(){try{const e=await fetch("/.netlify/functions/get-venues",{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){const t=await e.json();a=t.venues||[],function(){const e=document.getElementById("eventVenue");for(;e.children.length>2;)e.removeChild(e.lastChild);a.forEach(t=>{const n=document.createElement("option");n.value=t.id,n.textContent=t.name,e.appendChild(n)})}()}}catch(e){console.error("Error loading venues for dropdown:",e)}}function u(e=null){var t;const n=document.getElementById("venuesContainer"),o=e||a;if(0===o.length)return void(n.innerHTML='\n            <div class="search-container">\n                <input type="text" class="search-input" id="venueSearch" placeholder="Search venues..." onkeyup="filterVenues()">\n            </div>\n            <div class="empty-state">\n                <h3>No venues found</h3>\n                <p>Start by adding your first karting venue to manage events effectively.</p>\n                <button class="btn btn-success" onclick="openAddVenueModal()">Add Your First Venue</button>\n            </div>\n        ');const i=o.map(e=>'\n        <div class="venue-card">\n            <div class="venue-name">'.concat(e.name,'</div>\n            <div class="venue-details">\n                <div class="venue-detail"><strong>Address:</strong> ').concat(e.address,"</div>\n                ").concat(e.phone?'<div class="venue-detail"><strong>Phone:</strong> '.concat(e.phone,"</div>"):"","\n                ").concat(e.website?'<div class="venue-detail"><strong>Website:</strong> <a href="'.concat(e.website,'" target="_blank" style="color: #e74c3c;">Visit Site</a></div>'):"","\n                ").concat(e.notes?'<div class="venue-detail"><strong>Notes:</strong> '.concat(e.notes,"</div>"):"","\n                ").concat(e.drivingTips?'<div class="venue-detail"><strong>Driving Tips:</strong> '.concat(e.drivingTips.substring(0,100)).concat(e.drivingTips.length>100?"...":"","</div>"):"","\n                ").concat(e.vimeoId?'<div class="venue-detail"><strong>Video:</strong> <a href="https://vimeo.com/'.concat(e.vimeoId,'" target="_blank" style="color: #e74c3c;">Watch on Vimeo</a></div>'):"","\n                ").concat(e.trackMapPath?'<div class="venue-detail"><strong>Track Map:</strong> <span style="color: #27ae60;">✓ Available</span></div>':"",'\n                <div class="venue-detail"><strong>Added:</strong> ').concat(new Date(e.createdAt).toLocaleDateString(),'</div>\n            </div>\n            <div class="venue-actions">\n                <button class="action-btn edit-btn btn-small" onclick="editVenue(\'').concat(e.id,'\')">Edit</button>\n                <button class="action-btn delete-btn btn-small" onclick="deleteVenue(\'').concat(e.id,"')\">Delete</button>\n            </div>\n        </div>\n    ")).join("");n.innerHTML='\n        <div class="search-container">\n            <input type="text" class="search-input" id="venueSearch" placeholder="Search venues..." onkeyup="filterVenues()" value="'.concat((null==(t=document.getElementById("venueSearch"))?void 0:t.value)||"",'">\n        </div>\n        <div class="venues-grid">').concat(i,"</div>\n    ")}function m(){i=null,document.getElementById("modalTitle").textContent="Add New Venue",document.getElementById("venueForm").reset(),document.getElementById("trackMapPreview").style.display="none",document.getElementById("vimeoPreview").style.display="none",document.getElementById("vimeoPreview").querySelector("iframe").src="",document.getElementById("venueModal").style.display="block"}function p(){document.getElementById("venueModal").style.display="none",i=null}async function g(){try{const e=await fetch("/.netlify/functions/get-applications",{headers:{Authorization:"Bearer ".concat(t)}});if(401===e.status)return t=null,localStorage.removeItem("kartel_admin_token"),void b();if(!e.ok)throw new Error("Failed to load applications");const o=await e.json();n=o.applications||[],function(){const e=n.length,t=n.filter(e=>"pending"===e.status).length,o=n.filter(e=>"approved"===e.status).length,a=n.filter(e=>"rejected"===e.status).length;document.getElementById("totalApplications").textContent=e,document.getElementById("pendingApplications").textContent=t,document.getElementById("approvedApplications").textContent=o,document.getElementById("rejectedApplications").textContent=a}(),function(){const e=document.getElementById("applicationsTableBody");if(0===n.length)return void(e.innerHTML='<tr><td colspan="8" class="loading">No applications found</td></tr>');e.innerHTML=n.map(e=>"\n        <tr>\n            <td>\n                <strong>".concat(e.fullName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||e.name||"N/A","</strong>\n                ").concat(e.isAdmin?'<br><span style="color: #e74c3c; font-weight: bold; font-size: 12px;">👑 Administrator</span>':"","\n                ").concat(e.importedAt?'<br><small style="color: #6c757d;">📥 Imported</small>':"","\n            </td>\n            <td>").concat(e.email,"</td>\n            <td>\n                <strong>").concat(e.company||"N/A","</strong>\n                ").concat(e.position?"<br><small>".concat(e.position,"</small>"):"","\n            </td>\n            <td>").concat(e.phone,"</td>\n            <td>\n                ").concat(e.linkedin?'<a href="https://linkedin.com/in/'.concat(e.linkedin,'" target="_blank" style="color: #0077b5; text-decoration: none;">🔗 ').concat(e.linkedin,"</a>"):"N/A",'\n            </td>\n            <td><span class="status-badge status-').concat(e.status,'">').concat(e.status,"</span></td>\n            <td>").concat(new Date(e.submittedAt).toLocaleDateString(),"</td>\n            <td>\n                ").concat("pending"===e.status?'\n                    <button class="action-btn approve-btn" onclick="updateApplication(\''.concat(e.id,"', 'approved')\">Approve</button>\n                    <button class=\"action-btn reject-btn\" onclick=\"updateApplication('").concat(e.id,"', 'rejected')\">Reject</button>\n                "):"",'\n                <button class="action-btn details-btn" onclick="showDetails(\'').concat(e.id,'\')">Details</button>\n                <button class="action-btn delete-btn" onclick="deleteApplication(\'').concat(e.id,"')\">Delete</button>\n            </td>\n        </tr>\n    ")).join("")}()}catch(e){console.error("Error loading applications:",e),c("Failed to load applications. Please try again.")}}async function v(){try{const e=await fetch("/.netlify/functions/get-events",{headers:{Authorization:"Bearer ".concat(t)}});if(401===e.status)return t=null,localStorage.removeItem("kartel_admin_token"),void b();if(!e.ok)throw new Error("Failed to load events");const n=await e.json();o=n.events||[],function(){const e=o.length,t=o.filter(e=>"upcoming"===e.status).length,n=o.filter(e=>"completed"===e.status).length,a=o.reduce((e,t)=>e+(t.photos?t.photos.length:0),0);document.getElementById("totalEvents").textContent=e,document.getElementById("upcomingEvents").textContent=t,document.getElementById("completedEvents").textContent=n,document.getElementById("totalPhotos").textContent=a}(),function(){const e=document.getElementById("eventsTableBody");if(0===o.length)return void(e.innerHTML='<tr><td colspan="8" class="loading">No events found</td></tr>');e.innerHTML=o.map(e=>"\n        <tr>\n            <td><strong>".concat(e.name,"</strong></td>\n            <td>").concat(new Date(e.date).toLocaleDateString()).concat(e.time?"<br><small>".concat(e.time,"</small>"):"","</td>\n            <td><strong>").concat(e.venue,'</strong></td>\n            <td>\n                <span class="status-badge status-approved">').concat(e.attendees?e.attendees.length:0,"</span>\n                ").concat(e.attendees&&e.attendees.length>0?"<br><small>".concat(e.attendees.filter(e=>e.attended).length," attended</small>"):"",'\n            </td>\n            <td><span class="status-badge status-approved">').concat(e.photos?e.photos.length:0,'</span></td>\n            <td><span class="status-badge status-pending">').concat(e.videos?e.videos.length:0,'</span></td>\n            <td><span class="status-badge status-').concat(e.status,'">').concat(e.status,'</span></td>\n            <td>\n                <button class="action-btn edit-btn" onclick="editEvent(\'').concat(e.id,'\')">Edit</button>\n                <button class="action-btn delete-btn" onclick="deleteEvent(\'').concat(e.id,"')\">Delete</button>\n            </td>\n        </tr>\n    ")).join("")}()}catch(e){console.error("Error loading events:",e),c("Failed to load events. Please try again.","eventsMessageContainer")}}async function y(e){try{const n=await fetch("/.netlify/functions/get-events",{headers:{Authorization:"Bearer ".concat(t)}});if(n.ok){const t=(await n.json()).events.find(t=>t.id===e);t&&t.photos?f(t.photos):f([])}}catch(n){console.error("Error loading event photos:",n)}}function f(e){const t=document.getElementById("eventPhotosGrid");if(!e||0===e.length)return void(t.innerHTML='<p style="color: #7f8c8d; text-align: center; padding: 20px;">No photos uploaded yet</p>');const n=e.map(e=>'\n        <div class="photo-item">\n            <img src="/.netlify/functions/get-photo?path='.concat(encodeURIComponent(e.path),'" \n                alt="').concat(e.caption||"Event photo",'"\n                onerror="this.style.display=\'none\'">\n            ').concat(e.caption?'<div class="photo-caption">'.concat(e.caption,"</div>"):"","\n        </div>\n    ")).join("");t.innerHTML=n}async function h(e){try{const n=await fetch("/.netlify/functions/get-events",{headers:{Authorization:"Bearer ".concat(t)}});if(n.ok){const t=(await n.json()).events.find(t=>t.id===e);t&&t.videos?E(t.videos):E([])}}catch(n){console.error("Error loading event videos:",n)}}function E(e){const t=document.getElementById("eventVideosGrid");if(!e||0===e.length)return void(t.innerHTML='<p style="color: #7f8c8d; text-align: center; padding: 20px;">No videos uploaded yet</p>');const n=e.map(e=>'\n        <div style="border: 1px solid #ecf0f1; border-radius: 8px; padding: 15px; background: white;">\n            <div style="aspect-ratio: 16/9; margin-bottom: 10px;">\n                <iframe src="https://player.vimeo.com/video/'.concat(e.vimeoId,'" \n                        width="100%" height="100%" frameborder="0" \n                        allow="autoplay; fullscreen; picture-in-picture" allowfullscreen\n                        style="border-radius: 4px;">\n                </iframe>\n            </div>\n            <h5 style="color: #2c3e50; margin-bottom: 5px; font-size: 1rem;">').concat(e.title||"Untitled Video","</h5>\n            ").concat(e.description?'<p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 8px;">'.concat(e.description,"</p>"):"",'\n            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: #999;">\n                <span>Uploaded: ').concat(new Date(e.uploadedAt).toLocaleDateString(),'</span>\n                <a href="https://vimeo.com/').concat(e.vimeoId,'" target="_blank" style="color: #3498db;">View on Vimeo</a>\n            </div>\n        </div>\n    ')).join("");t.innerHTML=n}function w(){document.getElementById("eventModal").style.display="none";const e=document.querySelector(".email-section");e&&(e.style.display="none")}function I(){document.getElementById("applicantModal").style.display="none"}function b(){document.getElementById("loginSection").classList.remove("hidden"),document.getElementById("dashboardSection").classList.add("hidden")}async function B(){const e=new URLSearchParams(window.location.search),n=e.get("action"),o=e.get("id"),a=e.get("token");n&&o&&a&&(console.log("🚀 Processing quick action from URL: ".concat(n," for ").concat(o)),window.history.replaceState({},document.title,window.location.pathname),await async function(e,n,o){var a;try{d("Processing quick action...","info","messageContainer");const i=await fetch("/.netlify/functions/quick-action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e,applicationId:n,actionToken:o})}),s=await i.json();if(i.ok&&s.success){const n="approve"===e?"approved":"rejected";d("✅ Application from ".concat((null==(a=s.application)?void 0:a.name)||"applicant"," has been ").concat(n," successfully!"),"success","messageContainer"),t&&g()}else d("❌ Quick action failed: ".concat(s.error||"Unknown error"),"error","messageContainer")}catch(i){console.error("Quick action error:",i),d("❌ Quick action failed due to network error","error","messageContainer")}}(n,o,a))}async function C(){try{const e=await fetch("/.netlify/functions/get-applications",{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){const t=(await e.json()).applications.filter(e=>"approved"===e.status);return function(e){const t=document.getElementById("memberSelect");for(;t.children.length>1;)t.removeChild(t.lastChild);e.forEach(e=>{const n=document.createElement("option");n.value=e.id;const o=e.fullName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||e.name||"Unknown";n.textContent="".concat(o," (").concat(e.company||"No company",")"),n.dataset.email=e.email,n.dataset.company=e.company||"",t.appendChild(n)})}(t),t}}catch(e){console.error("Error loading approved members:",e)}return[]}async function A(e,t){try{const n=o.findIndex(t=>t.id===e);if(-1===n)return;o[n].attendees||(o[n].attendees=[]),o[n].attendees.push(t),await M(e,o[n].attendees),x(o[n].attendees),d("Attendee added successfully!","success","eventsMessageContainer")}catch(n){console.error("Error adding attendee:",n),c("Failed to add attendee. Please try again.","eventsMessageContainer")}}async function M(e,n){const o=await fetch("/.netlify/functions/update-event",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:e,updates:{attendees:n}})});if(!o.ok)throw new Error("Failed to update event attendees");return await o.json()}function x(e){const t=document.getElementById("attendeesList");if(!e||0===e.length)return t.innerHTML='<p style="color: #7f8c8d; text-align: center; padding: 20px;">No attendees added yet</p>',void k(0,0,0);const n=e.filter(e=>e.attended).length,o=e.filter(e=>!e.attended).length;k(e.length,n,o);const a=e.map(e=>'\n        <div class="attendee-item">\n            <div class="attendee-info">\n                <div class="attendee-name">'.concat(e.name,'</div>\n                <div class="attendee-details">\n                    ').concat(e.company?"".concat(e.company," • "):"").concat(e.email,"\n                    <br><small>Registered: ").concat(new Date(e.registeredAt).toLocaleDateString(),'</small>\n                </div>\n            </div>\n            <div class="attendee-status">\n                <span style="font-size: 0.8rem; margin-right: 8px;">\n                    ').concat(e.attended?"Attended":"Registered",'\n                </span>\n                <div class="status-toggle ').concat(e.attended?"attended":"",'" \n                    onclick="toggleAttendeeStatus(\'').concat(document.getElementById("editEventId").value,"', '").concat(e.memberId,'\')">\n                </div>\n                <button class="remove-attendee" \n                        onclick="removeAttendeeFromEvent(\'').concat(document.getElementById("editEventId").value,"', '").concat(e.memberId,"')\">\n                    Remove\n                </button>\n            </div>\n        </div>\n    ")).join("");t.innerHTML=a}function k(e,t,n){document.getElementById("registeredCount").textContent=e,document.getElementById("attendedCount").textContent=t,document.getElementById("noShowCount").textContent=n}async function S(e){const t=o.find(t=>t.id===e);t&&t.attendees?x(t.attendees):x([])}document.getElementById("photoUpload").addEventListener("change",function(e){const t=e.target.files[0],n=document.getElementById("photoPreview"),o=document.getElementById("uploadPhotoBtn");if(t){const e=new FileReader;e.onload=function(e){n.src=e.target.result,n.style.display="block",o.disabled=!1},e.readAsDataURL(t)}else n.style.display="none",o.disabled=!0}),document.getElementById("uploadPhotoBtn").addEventListener("click",async function(){const e=document.getElementById("photoUpload"),n=document.getElementById("photoCaption"),o=document.getElementById("editEventId").value;if(!e.files[0]||!o)return void c("Please select a photo and ensure an event is selected","eventsMessageContainer");const a=e.files[0],i=n.value.trim(),s=new FileReader;s.onload=async function(s){const r=s.target.result,l=document.getElementById("uploadPhotoBtn"),u=l.textContent;l.textContent="Uploading...",l.disabled=!0;try{const s=await fetch("/.netlify/functions/upload-photo",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:o,photoData:r,fileName:a.name,caption:i})}),l=await s.json();s.ok&&l.success?(d("Photo uploaded successfully!","success","eventsMessageContainer"),e.value="",n.value="",document.getElementById("photoPreview").style.display="none",await y(o),v()):c(l.error||"Failed to upload photo","eventsMessageContainer")}catch(m){console.error("Photo upload error:",m),c("Failed to upload photo. Please try again.","eventsMessageContainer")}finally{l.textContent=u,l.disabled=!1}},s.readAsDataURL(a)}),document.getElementById("videoUpload").addEventListener("change",function(e){const t=e.target.files[0],n=document.getElementById("videoPreview"),o=document.getElementById("uploadVideoBtn");if(t){const a=524288e3;if(t.size>a)return c("Video file size must be less than 500MB","eventsMessageContainer"),void(e.target.value="");const i=URL.createObjectURL(t);n.src=i,n.style.display="block",o.disabled=!1;const s=document.getElementById("videoTitle");s.value||(s.value=t.name.replace(/\.[^/.]+$/,""))}else n.style.display="none",o.disabled=!0}),document.getElementById("uploadVideoBtn").addEventListener("click",async function(){const e=document.getElementById("videoUpload"),n=document.getElementById("videoTitle"),o=document.getElementById("videoDescription"),a=document.getElementById("editEventId").value;if(!e.files[0]||!a)return void c("Please select a video and ensure an event is selected","eventsMessageContainer");const i=e.files[0],s=n.value.trim()||i.name,r=o.value.trim(),l=this,u=l.textContent,m=document.getElementById("uploadProgress"),p=document.getElementById("progressBar");l.textContent="Preparing Upload...",l.disabled=!0,m.style.display="block",p.style.width="10%";try{const g=new FileReader;g.onload=async function(g){const y=g.target.result;p.style.width="30%",l.textContent="Uploading to Vimeo...";try{const l=await fetch("/.netlify/functions/upload-video-vimeo",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:a,videoData:y,fileName:i.name,title:s,description:r})});p.style.width="90%";const u=await l.json();l.ok&&u.success?(p.style.width="100%",d('Video uploaded successfully to Vimeo! <a href="'.concat(u.vimeoUrl,'" target="_blank">View Video</a>'),"success","eventsMessageContainer"),e.value="",n.value="",o.value="",document.getElementById("videoPreview").style.display="none",await h(a),v()):c(u.error||"Failed to upload video to Vimeo","eventsMessageContainer")}catch(f){console.error("Video upload error:",f),c("Failed to upload video. Please try again.","eventsMessageContainer")}finally{l.textContent=u,l.disabled=!1,m.style.display="none",p.style.width="0%"}},g.readAsDataURL(i)}catch(g){console.error("Video processing error:",g),c("Failed to process video file. Please try again.","eventsMessageContainer"),l.textContent=u,l.disabled=!1,m.style.display="none"}}),document.addEventListener("DOMContentLoaded",function(){B(),console.log("📝 Admin.js loaded - authentication handled by unified system"),document.getElementById("refreshBtn").addEventListener("click",g),document.getElementById("refreshEventsBtn").addEventListener("click",v),document.getElementById("refreshVenuesBtn").addEventListener("click",r),document.getElementById("recoverBtn").addEventListener("click",async()=>{if(!confirm("⚠️ RECOVER DATA\n\nThis will attempt to rebuild the applications list from individual member records.\n\nThis is safe to run and will not delete any data.\n\nProceed?"))return;const e=document.getElementById("recoverBtn"),n=e.textContent;e.textContent="🔄 Recovering...",e.disabled=!0;try{const e=await fetch("/.netlify/functions/recover-applications-list",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),n=await e.json();e.ok&&n.success?(d("✅ Recovery successful! Recovered ".concat(n.recovered," members. Status: ").concat(JSON.stringify(n.statusBreakdown)),"success"),setTimeout(()=>{g()},1e3)):c("❌ Recovery failed: ".concat(n.error||"Unknown error"))}catch(o){console.error("Recovery error:",o),c("❌ Recovery failed due to network error")}finally{e.textContent=n,e.disabled=!1}}),document.getElementById("venueForm").addEventListener("submit",async function(e){e.preventDefault();const n=new FormData(this),o={name:n.get("venueName").trim(),address:n.get("venueAddress").trim(),phone:n.get("venuePhone").trim(),website:n.get("venueWebsite").trim(),notes:n.get("venueNotes").trim(),drivingTips:n.get("venueDrivingTips").trim(),vimeoId:n.get("venueVimeoId").trim()},a=n.get("venueTrackMap");if(a&&a.size>0){const e=new FileReader,t=await new Promise((t,n)=>{e.onload=e=>t(e.target.result),e.onerror=n,e.readAsDataURL(a)});o.trackMap={data:t,fileName:a.name,fileType:a.type}}if(!o.name||!o.address)return void c("Please fill in all required fields","venuesMessageContainer");const s=this.querySelector('button[type="submit"]'),u=s.textContent;s.textContent="Saving...",s.disabled=!0;try{let e;e=i?await fetch("/.netlify/functions/update-venue",{method:"PUT",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({venueId:i,...o})}):await fetch("/.netlify/functions/create-venue",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(o)});const n=await e.json();e.ok&&n.success?(d(n.message,"success","venuesMessageContainer"),p(),r(),l()):c(n.error||"Failed to save venue","venuesMessageContainer")}catch(m){console.error("Error saving venue:",m),c("Failed to save venue. Please try again.","venuesMessageContainer")}finally{s.textContent=u,s.disabled=!1}}),document.getElementById("venueTrackMap").addEventListener("change",function(e){const t=e.target.files[0],n=document.getElementById("trackMapPreview"),o=document.getElementById("trackMapImage");if(t){const e=new FileReader;e.onload=function(e){o.src=e.target.result,n.style.display="block"},e.readAsDataURL(t)}else n.style.display="none"}),document.getElementById("venueVimeoId").addEventListener("input",function(e){const t=e.target.value.trim(),n=document.getElementById("vimeoPreview"),o=n.querySelector("iframe");t&&/^\d+$/.test(t)?(o.src="https://player.vimeo.com/video/".concat(t),n.style.display="block"):(n.style.display="none",o.src="")}),document.getElementById("seedVenuesBtn").addEventListener("click",async function(){if(!confirm("This will add default venues if none exist. Continue?"))return;const e=this,n=e.textContent;e.textContent="Seeding...",e.disabled=!0;try{const e=await fetch("/.netlify/functions/seed-venues",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),n=await e.json();e.ok?(d(n.message,"success","venuesMessageContainer"),n.success&&(r(),l())):c(n.error||"Failed to seed venues","venuesMessageContainer")}catch(o){console.error("Error seeding venues:",o),c("Failed to seed venues. Please try again.","venuesMessageContainer")}finally{e.textContent=n,e.disabled=!1}}),document.getElementById("eventVenue").addEventListener("change",function(){"add-new"===this.value&&(m(),this.value="")}),document.getElementById("eventForm").addEventListener("submit",async function(e){e.preventDefault();const t=new FormData(e.target),n=t.get("eventVenue");if(!n)return void c("Please select a venue","eventsMessageContainer");const o=a.find(e=>e.id===n),i={name:t.get("eventName"),date:t.get("eventDate"),time:t.get("eventTime"),venueId:n,venue:o?o.name:"",venueAddress:o?o.address:"",maxAttendees:t.get("eventMaxAttendees"),description:t.get("eventDescription"),sendAnnouncement:"on"===t.get("sendAnnouncement")};await async function(e){U=e,document.getElementById("confirmEventName").textContent=e.name||"Not specified",document.getElementById("confirmEventDate").textContent=e.date?new Date(e.date).toLocaleDateString():"Not specified",document.getElementById("confirmEventTime").textContent=e.time||"Not specified",document.getElementById("confirmEventVenue").textContent=e.venue||"Not specified",document.getElementById("confirmEventMaxAttendees").textContent=e.maxAttendees||"No limit",document.getElementById("confirmEventDescription").textContent=e.description||"No description";const t=document.getElementById("announcementInfo"),n=document.getElementById("confirmButtonText");if(e.sendAnnouncement){t.style.display="block",n.textContent="Confirm & Send";try{const e=await Q();document.getElementById("approvedMemberCount").textContent=e}catch(o){console.error("Error loading approved members count:",o),document.getElementById("approvedMemberCount").textContent="Unknown"}}else t.style.display="none",n.textContent="Confirm & Create Event";document.getElementById("eventConfirmationModal").style.display="block"}(i)}),document.getElementById("editEventForm").addEventListener("submit",async function(e){e.preventDefault();const n=new FormData(this),o=n.get("editEventId"),i=n.get("editEventVenue");if(!i)return void c("Please select a venue","eventsMessageContainer");const s=a.find(e=>e.id===i),r={name:n.get("editEventName"),date:n.get("editEventDate"),time:n.get("editEventTime"),venueId:i,venue:s?s.name:"",venueAddress:s?s.address:"",maxAttendees:n.get("editEventMaxAttendees"),status:n.get("editEventStatus"),description:n.get("editEventDescription")},l=this.querySelector('button[type="submit"]'),u=l.textContent;l.textContent="Updating...",l.disabled=!0;try{const e=await fetch("/.netlify/functions/update-event",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:o,updates:r})}),n=await e.json();e.ok&&n.success?(d("Event updated successfully!","success","eventsMessageContainer"),w(),v()):c(n.error||"Failed to update event","eventsMessageContainer")}catch(m){console.error("Event update error:",m),c("Failed to update event. Please try again.","eventsMessageContainer")}finally{l.textContent=u,l.disabled=!1}}),document.getElementById("applicantForm").addEventListener("submit",async function(e){e.preventDefault();const n=new FormData(this),o={applicationId:n.get("applicantId"),firstName:n.get("applicantFirstName").trim(),lastName:n.get("applicantLastName").trim(),email:n.get("applicantEmail").trim(),company:n.get("applicantCompany").trim(),position:n.get("applicantPosition").trim(),phone:n.get("applicantPhone").trim(),linkedin:s(n.get("applicantLinkedin")),status:n.get("applicantStatus"),isAdmin:document.getElementById("applicantIsAdmin").checked};if(!o.firstName||!o.lastName||!o.email)return void d("First name, last name, and email are required.","error","applicantMessage");const a=this.querySelector('button[type="submit"]'),i=a.textContent;a.textContent="Saving...",a.disabled=!0;try{const e=await async function(e){try{const n=await fetch("/.netlify/functions/update-applicant-details",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(e)});if(401===n.status)return t=null,localStorage.removeItem("kartel_admin_token"),b(),!1;const o=await n.json();return n.ok&&o.success?(d("Applicant details updated successfully!","success","messageContainer"),g(),!0):(d(o.error||"Failed to update applicant details.","error","applicantMessage"),!1)}catch(n){return console.error("Error updating applicant details:",n),d("Failed to update applicant details due to network error. Please try again.","error","applicantMessage"),!1}}(o);e&&setTimeout(()=>{I()},2e3)}finally{a.textContent=i,a.disabled=!1}}),document.getElementById("confirmCreateEventBtn").addEventListener("click",async function(){await async function(){if(!U)return void c("No event data found","eventsMessageContainer");const e=document.getElementById("confirmCreateEventBtn"),n=e.innerHTML;e.innerHTML="Creating...",e.disabled=!0;try{const e=await fetch("/.netlify/functions/create-event",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(U)}),n=await e.json();e.ok&&n.success?(R(),d("Event created successfully!","success","eventsMessageContainer"),document.getElementById("eventForm").reset(),v()):c(n.error||"Failed to create event","eventsMessageContainer")}catch(o){console.error("Event creation error:",o),c("Failed to create event. Please try again.","eventsMessageContainer")}finally{e.innerHTML=n,e.disabled=!1}}()}),document.getElementById("sendTestEmailBtn").addEventListener("click",async function(){await async function(){if(!U)return void c("No event data found","eventsMessageContainer");let e=null;try{const t=localStorage.getItem("kartel_admin_user");if(t){e=JSON.parse(t).email}}catch(a){console.error("Error getting stored user data:",a)}if(!e){if(e=prompt("Enter your email address for the test email:"),!e)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return void c("Please enter a valid email address","eventsMessageContainer")}const n=document.getElementById("sendTestEmailBtn"),o=n.textContent;n.textContent="Sending...",n.disabled=!0;try{const n={...U,id:"test-".concat(Date.now()),createdAt:(new Date).toISOString()},o=await fetch("/.netlify/functions/send-test-email",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:n.id,adminEmail:e,eventData:n})}),a=await o.json();o.ok&&a.success?d("Test email sent successfully to ".concat(e,"!"),"success","eventsMessageContainer"):c(a.error||"Failed to send test email","eventsMessageContainer")}catch(a){console.error("Test email error:",a),c("Failed to send test email. Please try again.","eventsMessageContainer")}finally{n.textContent=o,n.disabled=!1}}()}),window.onclick=function(e){const t=document.getElementById("venueModal"),n=document.getElementById("eventModal"),o=document.getElementById("applicantModal"),a=document.getElementById("eventConfirmationModal");e.target===t&&p(),e.target===n&&w(),e.target===o&&I(),e.target===a&&R()};const e=document.getElementById("videoUpload"),n=document.getElementById("videoTitle"),o=document.getElementById("videoDescription"),u=document.getElementById("videoPreview"),y=document.getElementById("uploadVideoBtn"),f=document.getElementById("uploadProgress"),E=document.getElementById("progressBar");e.addEventListener("change",function(t){const o=t.target.files[0];if(!o)return u.style.display="none",void(y.disabled=!0);if(o.size>524288e3)return alert("File size must be less than 500MB"),e.value="",u.style.display="none",void(y.disabled=!0);if(!["video/mp4","video/mov","video/quicktime","video/avi"].includes(o.type))return alert("Please select a valid video file (MP4, MOV, AVI)"),e.value="",u.style.display="none",void(y.disabled=!0);const a=URL.createObjectURL(o);u.src=a,u.style.display="block",y.disabled=!1,n.value||(n.value=o.name.replace(/\.[^/.]+$/,""))}),y.addEventListener("click",async function(){const a=e.files[0];if(!a)return;const i=document.getElementById("editEventId").value;if(!i)return void alert("Please save the event first before uploading videos");const s=n.value.trim()||a.name,r=o.value.trim();f.style.display="block",y.disabled=!0,y.textContent="Uploading...",E.style.width="10%";try{const c=await new Promise((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsDataURL(a)});E.style.width="30%";const l=await fetch("/.netlify/functions/upload-video-vimeo",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:i,videoData:c,fileName:a.name,title:s,description:r})});if(E.style.width="80%",!l.ok){const e=await l.json();throw new Error(e.error||"Upload failed")}const m=await l.json();if(E.style.width="100%",!m.success)throw new Error(m.error||"Upload failed");d("Video uploaded to Vimeo successfully!","success","eventsMessageContainer"),e.value="",n.value="",o.value="",u.style.display="none",h(i),v()}catch(l){console.error("Video upload error:",l),c("Video upload failed: ".concat(l.message),"eventsMessageContainer")}finally{f.style.display="none",y.disabled=!1,y.textContent="Upload to Vimeo",E.style.width="0%"}}),console.log("🔧 Admin.js loaded, waiting for unified auth...")}),document.getElementById("memberSelect").addEventListener("change",function(){document.getElementById("addAttendeeBtn").disabled=!this.value}),document.getElementById("addAttendeeBtn").addEventListener("click",function(){var e;const t=document.getElementById("memberSelect"),n=t.options[t.selectedIndex];if(!n.value)return;const a=document.getElementById("editEventId").value,i=n.value,s=n.textContent.split(" (")[0],d=n.dataset.email,r=n.dataset.company;(null==(e=o.find(e=>e.id===a).attendees)?void 0:e.find(e=>e.memberId===i))?c("This member is already added to the event","eventsMessageContainer"):(A(a,{memberId:i,name:s,email:d,company:r,registeredAt:(new Date).toISOString(),attended:!1}),t.value="",document.getElementById("addAttendeeBtn").disabled=!0)}),window.switchTab=function(e){document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".tab-button").forEach(e=>e.classList.remove("active")),document.getElementById(e+"Tab").classList.add("active"),event.target.classList.add("active"),"applications"===e?g():"events"===e?(v(),l()):"venues"===e?r():"content"===e&&(L(),j(),V())},window.openAddVenueModal=m,window.closeVenueModal=p,window.editVenue=function(e){const t=a.find(t=>t.id===e);if(!t)return;i=e,document.getElementById("modalTitle").textContent="Edit Venue",document.getElementById("venueId").value=t.id,document.getElementById("venueName").value=t.name,document.getElementById("venueAddress").value=t.address,document.getElementById("venuePhone").value=t.phone||"",document.getElementById("venueWebsite").value=t.website||"",document.getElementById("venueNotes").value=t.notes||"",document.getElementById("venueDrivingTips").value=t.drivingTips||"",document.getElementById("venueVimeoId").value=t.vimeoId||"";const n=document.getElementById("trackMapPreview"),o=document.getElementById("trackMapImage");t.trackMapPath?(o.src="/.netlify/functions/get-photo?path=".concat(encodeURIComponent(t.trackMapPath)),n.style.display="block"):n.style.display="none";const s=document.getElementById("vimeoPreview"),d=s.querySelector("iframe");t.vimeoId&&/^\d+$/.test(t.vimeoId)?(d.src="https://player.vimeo.com/video/".concat(t.vimeoId),s.style.display="block"):(s.style.display="none",d.src=""),document.getElementById("venueModal").style.display="block"},window.deleteVenue=async function(e){const n=a.find(t=>t.id===e);if(n&&confirm('Are you sure you want to delete "'.concat(n.name,'"?')))try{const n=await fetch("/.netlify/functions/delete-venue",{method:"DELETE",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({venueId:e})}),o=await n.json();n.ok&&o.success?(d(o.message,"success","venuesMessageContainer"),r(),l()):c(o.error||"Failed to delete venue","venuesMessageContainer")}catch(o){console.error("Error deleting venue:",o),c("Failed to delete venue. Please try again.","venuesMessageContainer")}},window.filterVenues=function(){const e=document.getElementById("venueSearch").value.toLowerCase();if(!e.trim())return void u();u(a.filter(t=>t.name.toLowerCase().includes(e)||t.address.toLowerCase().includes(e)||t.notes&&t.notes.toLowerCase().includes(e)||t.drivingTips&&t.drivingTips.toLowerCase().includes(e)))},window.updateApplication=async function(e,n){try{if(!(await fetch("/.netlify/functions/update-application",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({applicationId:e,status:n,sendEmail:!0})})).ok)throw new Error("Failed to update application");d("Application ".concat(n," successfully! Email sent to applicant.")),g()}catch(o){console.error("Error updating application:",o),c("Failed to update application. Please try again.")}},window.deleteApplication=async function(e){const o=n.find(t=>t.id===e);if(!o)return;const a=o.fullName||"".concat(o.firstName||""," ").concat(o.lastName||"").trim()||"Unknown";if(confirm("Are you sure you want to permanently delete the application for ".concat(a,"?")))try{if(!(await fetch("/.netlify/functions/delete-application",{method:"DELETE",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({applicationId:e})})).ok)throw new Error("Failed to delete application");d("Application for ".concat(a," deleted successfully.")),g()}catch(i){console.error("Error deleting application:",i),c("Failed to delete application. Please try again.")}},window.showDetails=function(e){const t=n.find(t=>t.id===e);if(!t)return;document.getElementById("applicantId").value=t.id,document.getElementById("applicantFirstName").value=t.firstName||"",document.getElementById("applicantLastName").value=t.lastName||"",document.getElementById("applicantEmail").value=t.email||"",document.getElementById("applicantCompany").value=t.company||"",document.getElementById("applicantPosition").value=t.position||"",document.getElementById("applicantPhone").value=t.phone||"",document.getElementById("applicantLinkedin").value=t.linkedin||"",document.getElementById("applicantOriginalMessage").value=t.message||"",document.getElementById("applicantStatus").value=t.status||"pending",document.getElementById("applicantSubmitted").value=new Date(t.submittedAt).toLocaleString(),document.getElementById("applicantIsAdmin").checked=t.isAdmin||!1;const o=document.getElementById("applicantMessage");o&&(o.classList.add("hidden"),o.textContent=""),document.getElementById("applicantModal").style.display="block"},window.editEvent=function(e){const n=o.find(t=>t.id===e);if(!n)return void c("Event not found","eventsMessageContainer");if(document.getElementById("editEventId").value=n.id,document.getElementById("editEventName").value=n.name,document.getElementById("editEventDate").value=n.date,document.getElementById("editEventTime").value=n.time||"",document.getElementById("editEventMaxAttendees").value=n.maxAttendees||"",document.getElementById("editEventStatus").value=n.status||"upcoming",document.getElementById("editEventDescription").value=n.description||"",function(){const e=document.getElementById("editEventVenue");for(;e.children.length>1;)e.removeChild(e.lastChild);a.forEach(t=>{const n=document.createElement("option");n.value=t.id,n.textContent=t.name,e.appendChild(n)})}(),n.venueId)document.getElementById("editEventVenue").value=n.venueId;else{const e=Array.from(document.getElementById("editEventVenue").options).find(e=>e.textContent===n.venue);e&&(document.getElementById("editEventVenue").value=e.value)}y(n.id),h(n.id),S(n.id),C(),async function(){try{const e=await Q();document.getElementById("modalApprovedMemberCount").textContent=e}catch(e){console.error("Error loading member count for modal:",e),document.getElementById("modalApprovedMemberCount").textContent="Unknown"}}(),function(e){const n=document.getElementById("sendAnnouncementEmailBtn"),a=document.getElementById("sendReminderEmailBtn"),i=document.getElementById("modalSendTestEmailBtn"),s=n.cloneNode(!0),r=a.cloneNode(!0),l=i.cloneNode(!0);n.parentNode.replaceChild(s,n),a.parentNode.replaceChild(r,a),i.parentNode.replaceChild(l,i),s.addEventListener("click",async function(){await async function(e){const n=o.find(t=>t.id===e);if(!n)return void c("Event not found","eventModalMessageContainer");const a='Send announcement email to all approved members about "'.concat(n.name,'" on ').concat(new Date(n.date).toLocaleDateString(),"?");if(!confirm(a))return;const i=document.getElementById("sendAnnouncementEmailBtn"),s=i.textContent;i.textContent="Sending...",i.disabled=!0;try{const o=await fetch("/.netlify/functions/send-event-announcement",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:e,eventName:n.name,eventDate:n.date,eventTime:n.time,eventVenue:n.venue,eventDescription:n.description})});if(o.ok){const e=await o.json();d("Announcement sent successfully! ".concat(e.emailsSent," emails sent."),"success","eventModalMessageContainer")}else{const e=await o.json();c("Failed to send announcement: ".concat(e.error),"eventModalMessageContainer")}}catch(r){console.error("Error sending announcement:",r),c("An error occurred while sending the announcement","eventModalMessageContainer")}finally{i.textContent=s,i.disabled=!1}}(e)}),r.addEventListener("click",async function(){await async function(e){const n=o.find(t=>t.id===e);if(!n)return void c("Event not found","eventModalMessageContainer");const a='Send reminder email to all approved members about "'.concat(n.name,'" on ').concat(new Date(n.date).toLocaleDateString(),"?");if(!confirm(a))return;const i=document.getElementById("sendReminderEmailBtn"),s=i.textContent;i.textContent="Sending...",i.disabled=!0;try{const o=await fetch("/.netlify/functions/send-event-announcement",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:e,eventName:n.name,eventDate:n.date,eventTime:n.time,eventVenue:n.venue,eventDescription:n.description,isReminder:!0})});if(o.ok){const e=await o.json();d("Reminder sent successfully! ".concat(e.stats.sent," emails sent."),"success","eventModalMessageContainer")}else{const e=await o.json();c("Failed to send reminder: ".concat(e.error),"eventModalMessageContainer")}}catch(r){console.error("Error sending reminder:",r),c("An error occurred while sending the reminder","eventModalMessageContainer")}finally{i.textContent=s,i.disabled=!1}}(e)}),l.addEventListener("click",async function(){await async function(e){const n=o.find(t=>t.id===e);if(!n)return void c("Event not found","eventsMessageContainer");let a=null;try{const e=localStorage.getItem("kartel_admin_user");if(e){a=JSON.parse(e).email}}catch(u){console.error("Error getting stored user data:",u)}if(!a){if(a=prompt("Enter your email address for the test email:"),!a)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return void c("Please enter a valid email address","eventsMessageContainer")}const i=document.getElementById("testEmailType"),s=!!i&&"reminder"===i.value,r=document.getElementById("modalSendTestEmailBtn"),l=r.textContent;r.textContent="Sending...",r.disabled=!0;try{const o=await fetch("/.netlify/functions/send-test-email",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({eventId:e,adminEmail:a,eventData:n,isReminder:s})}),i=await o.json();if(o.ok&&i.success){d("Test ".concat(s?"reminder":"announcement"," email sent successfully to ").concat(a,"!"),"success","eventModalMessageContainer")}else c("Failed to send test email: ".concat(i.error),"eventModalMessageContainer")}catch(u){console.error("Error sending test email:",u),c("An error occurred while sending the test email","eventModalMessageContainer")}finally{r.textContent=l,r.disabled=!1}}(e)})}(n.id);const i=document.querySelector(".email-section");i&&(i.style.display="block"),document.getElementById("eventModal").style.display="block"},window.closeEventModal=w,window.deleteEvent=function(e){confirm("Are you sure you want to delete this event?")&&alert("Event deletion feature coming soon!")},window.loadEventPhotos=y,window.displayEventPhotos=f,window.loadEventVideos=h,window.displayEventVideos=E,window.addAttendeeToEvent=A,window.removeAttendeeFromEvent=async function(e,t){try{const n=o.findIndex(t=>t.id===e);if(-1===n)return;o[n].attendees=o[n].attendees.filter(e=>e.memberId!==t),await M(e,o[n].attendees),x(o[n].attendees),d("Attendee removed successfully!","success","eventsMessageContainer")}catch(n){console.error("Error removing attendee:",n),c("Failed to remove attendee. Please try again.","eventsMessageContainer")}},window.toggleAttendeeStatus=async function(e,t){try{const n=o.findIndex(t=>t.id===e);if(-1===n)return;const a=o[n].attendees.find(e=>e.memberId===t);if(!a)return;a.attended=!a.attended,a.statusUpdatedAt=(new Date).toISOString(),await M(e,o[n].attendees),x(o[n].attendees)}catch(n){console.error("Error updating attendee status:",n),c("Failed to update attendance status. Please try again.","eventsMessageContainer")}},window.loadEventAttendees=S,window.loadApprovedMembers=C;let T=[],F=[],P=[];async function L(){try{console.log("Loading gallery management...");try{const e=await fetch("/.netlify/functions/get-gallery",{headers:{Authorization:"Bearer ".concat(t)}});if(console.log("Get gallery response status:",e.status),e.ok){const t=await e.json();console.log("Gallery data received:",t),T=t.photos||[],z()}else{const t=await e.json().catch(()=>({error:"Unknown error"}));console.log("Gallery fetch error:",t),T=[]}}catch(e){console.error("Error fetching gallery:",e),T=[]}try{await async function(){try{console.log("Loading available photos from events...");const e=await fetch("/.netlify/functions/get-events",{headers:{Authorization:"Bearer ".concat(t)}});if(console.log("Get events response status:",e.status),!e.ok){const t=await e.json().catch(()=>({error:"Unknown error"}));throw console.error("Events fetch error:",t),new Error("Failed to fetch events: ".concat(t.error||e.status))}{const t=await e.json();console.log("Events data received:",t);const n=t.events||[];F=[],n.forEach(e=>{e.photos&&e.photos.length>0&&(console.log('Event "'.concat(e.name,'" has ').concat(e.photos.length," photos")),e.photos.forEach(t=>{F.push({...t,eventName:e.name,eventDate:e.date})}))}),console.log("Total photos collected: ".concat(F.length))}}catch(e){throw console.error("Error loading available photos:",e),e}}(),console.log("Available photos loaded, count:",F.length)}catch(n){console.error("Error loading available photos:",n),F=[]}N(),console.log("Gallery management loaded successfully")}catch(o){console.error("Error in loadGalleryManagement:",o),c("Failed to load gallery management: ".concat(o.message),"galleryMessageContainer")}}function N(){const e=document.getElementById("availablePhotosGrid"),t=document.getElementById("selectedPhotosGrid");console.log("Rendering gallery management. Available photos:",F.length,"Selected photos:",T.length),0===F.length?e.innerHTML='<p style="color: #7f8c8d; text-align: center; grid-column: 1 / -1;">No event photos available. Upload photos to events first.</p>':e.innerHTML=F.map(e=>{const t=e.url||e.src||"/.netlify/functions/get-photo?path=".concat(encodeURIComponent(e.path));return'\n            <div class="photo-item" style="position: relative; cursor: pointer; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); '.concat(T.find(t=>t.id===e.id)?"opacity: 0.5;":"",'" \n                 onclick="selectPhoto(\'').concat(e.id,'\')">\n                <img src="').concat(t,'" alt="').concat(e.caption||"Event photo",'" style="width: 100%; height: 120px; object-fit: cover;">\n                <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 8px 6px 6px; font-size: 0.7rem;">\n                    <div style="font-weight: 600;">').concat(e.eventName,'</div>\n                    <div style="opacity: 0.8;">').concat(e.eventDate,"</div>\n                </div>\n                ").concat(T.find(t=>t.id===e.id)?'<div style="position: absolute; top: 5px; right: 5px; background: #27ae60; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem;">✓</div>':"","\n            </div>\n            ")}).join(""),0===T.length?t.innerHTML='<p style="color: #7f8c8d; text-align: center; grid-column: 1 / -1;">Click photos from the left to add them here</p>':t.innerHTML=T.map(e=>{const t=e.url||e.src||"/.netlify/functions/get-photo?path=".concat(encodeURIComponent(e.path));return'\n            <div class="photo-item" style="position: relative; cursor: pointer; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" \n                 onclick="deselectPhoto(\''.concat(e.id,'\')">\n                <img src="').concat(t,'" alt="').concat(e.caption||"Event photo",'" style="width: 100%; height: 100px; object-fit: cover;">\n                <div style="position: absolute; top: 2px; right: 2px; background: #e74c3c; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; cursor: pointer;">×</div>\n            </div>\n            ')}).join(""),document.getElementById("selectedCount").textContent=T.length}async function j(){try{const e=await fetch("/.netlify/functions/get-faqs",{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){const t=await e.json();P=t.faqs||[],document.getElementById("totalFaqs").textContent=P.length,function(){const e=document.getElementById("faqContainer");if(0===P.length)return void(e.innerHTML='\n            <div class="empty-state">\n                <h3>No FAQs found</h3>\n                <p>Start by adding your first FAQ to help visitors understand The Kartel better.</p>\n                <button class="btn btn-success" onclick="openAddFaqModal()">Add Your First FAQ</button>\n            </div>\n        ');e.innerHTML=P.map(e=>'\n        <div class="faq-item" style="background: white; border: 1px solid #ecf0f1; border-radius: 8px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">\n            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">\n                <h4 style="color: #2c3e50; font-weight: 600; margin: 0; flex: 1;">'.concat(e.question,'</h4>\n                <div style="display: flex; gap: 10px; margin-left: 15px;">\n                    <button class="btn btn-secondary btn-small" onclick="editFaq(\'').concat(e.id,'\')">Edit</button>\n                    <button class="btn btn-danger btn-small" onclick="deleteFaq(\'').concat(e.id,'\')">Delete</button>\n                </div>\n            </div>\n            <p style="color: #5d6d7e; margin: 0; line-height: 1.5;">').concat(e.answer,'</p>\n            <small style="color: #95a5a6; display: block; margin-top: 10px;">Order: ').concat(e.order||"Not set","</small>\n        </div>\n    ")).join("")}()}}catch(e){console.error("Error loading FAQs:",e),c("Failed to load FAQs. Please try again.","faqMessageContainer")}}function D(){document.getElementById("faqModal").style.display="none"}async function V(){try{const e=await fetch("/.netlify/functions/get-experience-video",{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){const t=(await e.json()).vimeoId||"1092055210";document.getElementById("experienceVimeoId").value=t,q(t),O(t)}}catch(e){console.error("Error loading experience video:",e),c("Failed to load experience video. Please try again.","videoMessageContainer")}}function q(e){const t=document.getElementById("experienceVideoPreview");e&&e.trim()?t.innerHTML='\n            <iframe src="https://player.vimeo.com/video/'.concat(e,'" \n                    width="100%" height="100%" frameborder="0" \n                    allow="autoplay; fullscreen; picture-in-picture" \n                    allowfullscreen></iframe>\n        '):t.innerHTML='<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #7f8c8d;">No video selected</div>'}function z(){document.getElementById("totalGalleryPhotos").textContent=T.length}function O(e){document.getElementById("experienceVideoId").textContent=e||"-",document.getElementById("contentLastUpdated").textContent=(new Date).toLocaleDateString()}document.getElementById("faqForm").addEventListener("submit",async e=>{e.preventDefault();const n=new FormData(e.target),o={id:n.get("faqId")||Date.now().toString(),question:n.get("faqQuestion"),answer:n.get("faqAnswer"),order:parseInt(n.get("faqOrder"))||P.length+1};try{if(!(await fetch("/.netlify/functions/update-faq",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(o)})).ok)throw new Error("Failed to save FAQ");d("FAQ saved successfully!","success","faqMessageContainer"),D(),j()}catch(a){console.error("Error saving FAQ:",a),c("Failed to save FAQ. Please try again.","faqMessage")}}),document.getElementById("experienceVimeoId").addEventListener("input",e=>{q(e.target.value.trim())});let U=null;function R(){document.getElementById("eventConfirmationModal").style.display="none",U=null}async function Q(){try{const e=await fetch("/.netlify/functions/get-applications",{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){const t=await e.json();return t.applications.filter(e=>"approved"===e.status).length}return 0}catch(e){return console.error("Error loading approved members:",e),0}}window.loadGalleryManagement=L,window.selectPhoto=function(e){if(T.length>=12)return void c("Maximum 12 photos allowed in gallery","galleryMessageContainer");const t=F.find(t=>t.id===e);t&&!T.find(t=>t.id===e)&&(T.push(t),N())},window.deselectPhoto=function(e){T=T.filter(t=>t.id!==e),N()},window.saveGallerySelection=async function(){try{console.log("Saving gallery selection:",T);const e=T.map(e=>({id:e.id,url:e.url||e.src||"/.netlify/functions/get-photo?path=".concat(encodeURIComponent(e.path)),alt:e.alt||e.caption||"Photo from ".concat(e.eventName),caption:e.caption||"Photo from ".concat(e.eventName),eventName:e.eventName,eventDate:e.eventDate,uploadedAt:e.uploadedAt}));console.log("Photos prepared for frontend:",e);const n=await fetch("/.netlify/functions/update-gallery",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({photos:e})});if(console.log("Response status:",n.status),!n.ok){const e=await n.json().catch(()=>({error:"Unknown error"}));throw console.error("Error response:",e),new Error(e.error||"Server error: ".concat(n.status))}{const e=await n.json();console.log("Success response:",e),d("Gallery updated successfully!","success","galleryMessageContainer"),z()}}catch(e){console.error("Error saving gallery:",e),c("Failed to save gallery: ".concat(e.message),"galleryMessageContainer")}},window.loadFaqs=j,window.openAddFaqModal=function(){document.getElementById("faqModalTitle").textContent="Add FAQ",document.getElementById("faqId").value="",document.getElementById("faqQuestion").value="",document.getElementById("faqAnswer").value="",document.getElementById("faqOrder").value="",document.getElementById("faqModal").style.display="block"},window.editFaq=function(e){const t=P.find(t=>t.id===e);t&&(document.getElementById("faqModalTitle").textContent="Edit FAQ",document.getElementById("faqId").value=t.id,document.getElementById("faqQuestion").value=t.question,document.getElementById("faqAnswer").value=t.answer,document.getElementById("faqOrder").value=t.order||"",document.getElementById("faqModal").style.display="block")},window.closeFaqModal=D,window.deleteFaq=async function(e){if(confirm("Are you sure you want to delete this FAQ?"))try{if(!(await fetch("/.netlify/functions/delete-faq",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({id:e})})).ok)throw new Error("Failed to delete FAQ");d("FAQ deleted successfully!","success","faqMessageContainer"),j()}catch(n){console.error("Error deleting FAQ:",n),c("Failed to delete FAQ. Please try again.","faqMessageContainer")}},window.seedFaqs=async function(){if(confirm("This will populate the CMS with the existing FAQs from the website. Continue?"))try{const e=await fetch("/.netlify/functions/seed-faqs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!e.ok)throw new Error("Failed to seed FAQs");d((await e.json()).message,"success","faqMessageContainer"),j()}catch(e){console.error("Error seeding FAQs:",e),c("Failed to seed FAQs. Please try again.","faqMessageContainer")}},window.loadExperienceVideo=V,window.updateExperienceVideo=async function(){const e=document.getElementById("experienceVimeoId").value.trim();if(e)try{if(!(await fetch("/.netlify/functions/update-experience-video",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({vimeoId:e})})).ok)throw new Error("Failed to update experience video");d("Experience video updated successfully!","success","videoMessageContainer"),q(e),O(e)}catch(n){console.error("Error updating experience video:",n),c("Failed to update experience video. Please try again.","videoMessageContainer")}else c("Please enter a Vimeo video ID","videoMessageContainer")},window.closeApplicantModal=I,window.closeEventConfirmationModal=R,window.switchToMemberView=function(){const e=localStorage.getItem("kartel_admin_user");if(e)try{const t=JSON.parse(e);console.log("👨‍💼 Switching to member view for admin:",t.email),sessionStorage.setItem("switched_from_admin","true"),window.location.href="/members.html"}catch(t){console.error("Error parsing admin user data:",t),window.location.href="/members.html"}else window.location.href="/members.html"},window.showDashboard=function(){document.getElementById("loginSection").classList.add("hidden"),document.getElementById("dashboardSection").classList.remove("hidden"),g()},window.loadApplications=g,window.loadVenuesForDropdown=l,console.log("📦 Admin bundle loaded");export{e as __vite_legacy_guard};
